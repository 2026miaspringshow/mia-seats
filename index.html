<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 MIA SPRING SHOW | ç¥¨å‹™ç³»çµ±</title>
    <style>
        :root { --primary-blue: #1a237e; --accent-blue: #3f51b5; --bg-gray: #f8f9fa; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background-color: var(--bg-gray); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* é ‚éƒ¨æ¨™é¡Œ */
        .header { background: linear-gradient(135deg, #1a237e 0%, #311b92 100%); color: white; padding: 15px 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .header h1 { margin: 0; font-size: 18px; letter-spacing: 1px; }
        .header p { margin: 5px 0 0; font-size: 14px; opacity: 0.8; }

        /* åº§ä½å€åŸŸæ’ç‰ˆ */
        .main-content { flex: 1; overflow-y: auto; padding-bottom: 100px; display: flex; flex-direction: column; align-items: center; }
        .legend-area { display: flex; gap: 15px; margin: 20px 0; font-size: 12px; color: #666; justify-content: center; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-box { width: 16px; height: 16px; border-radius: 4px; border: 1px solid #ddd; background: white; }

        .venue-wrapper { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; padding: 10px 0; }
        .stage-area { width: fit-content; min-width: 1100px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; padding: 0 40px; }
        .screen { background: #333; width: 400px; margin-bottom: 50px; padding: 10px; color: #fff; border-radius: 0 0 80px 80px; font-weight: bold; text-align: center; font-size: 14px; }
        
        .venue-container { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 50px; }
        .block { display: flex; flex-direction: column; gap: 8px; }
        .row { display: flex; gap: 5px; height: 32px; align-items: center; }

        /* åº§ä½æ¨£å¼ */
        .seat { width: 34px; height: 34px; font-size: 10px; border-radius: 6px; display: flex; align-items: center; justify-content: center; border: 1px solid #e0e0e0; background: white; cursor: pointer; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .available:hover { border-color: var(--accent-blue); transform: translateY(-2px); }
        .sold { background-color: #eeeeee !important; color: #bbb !important; cursor: not-allowed; border: none; }
        .selected { background-color: var(--primary-blue) !important; color: white !important; border-color: var(--primary-blue) !important; box-shadow: 0 4px 8px rgba(26,35,126,0.3); }
        .camera-seat { background: #424242 !important; border: none; position: relative; }
        .camera-seat::after { content: "ğŸ“·"; font-size: 12px; }
        .pr-seat { border: 1px solid #ffca28 !important; background-color: #fffde7; }

        /* ç½®åº•çµå¸³åˆ— */
        .bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 80px; background: white; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 100; }
        .price-info { display: flex; flex-direction: column; }
        .price-total { font-size: 24px; font-weight: bold; color: var(--accent-blue); }
        .seat-count { font-size: 13px; color: #888; }
        .btn-checkout { background: var(--primary-blue); color: white; border: none; padding: 12px 40px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.3s; }
        .btn-checkout:disabled { background: #ccc; cursor: not-allowed; }

        /* è³¼ç¥¨å½ˆçª— */
        .modal-overlay { position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 200; padding: 20px; }
        .modal { background: white; width: 100%; max-width: 450px; border-radius: 16px; overflow: hidden; display: flex; flex-direction: column; max-height: 90vh; }
        .modal-header { background: #f8f9fa; padding: 20px; border-bottom: 1px solid #eee; font-weight: bold; text-align: center; }
        .modal-body { padding: 20px; overflow-y: auto; }
        .modal-footer { padding: 15px; background: #f8f9fa; display: flex; gap: 10px; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 13px; color: #666; margin-bottom: 5px; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .selected-list { background: #e8eaf6; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 14px; color: var(--primary-blue); font-weight: bold; }
        
        .payment-box { border: 2px solid var(--accent-blue); border-radius: 10px; padding: 15px; text-align: center; margin-bottom: 15px; background: #f0f2ff; }
        .admin-btn { position: absolute; bottom: 90px; right: 20px; font-size: 10px; color: #ccc; background: none; border: none; }
    </style>
</head>
<body>

    <div class="header">
        <h1>2026 8th MIA SPRING SHOW</h1>
        <p>å³æ™‚åº§ä½ç³»çµ±</p>
    </div>

    <div class="main-content">
        <div class="legend-area">
            <div class="legend-item"><div class="legend-box"></div> å¯é¸ä½</div>
            <div class="legend-item"><div class="legend-box" style="background:var(--primary-blue); border:none;"></div> å·²é¸æ“‡</div>
            <div class="legend-item"><div class="legend-box" style="background:#eee; border:none;"></div> å·²å”®å‡º</div>
            <div class="legend-item"><div class="legend-box pr-seat"></div> é ç•™å¸­</div>
            <div class="legend-item"><div class="legend-box camera-seat"></div> æ”å½±å€</div>
        </div>

        <div class="venue-wrapper">
            <div class="stage-area">
                <div class="screen">STAGE èˆ å°</div>
                <div class="venue-container" id="grid">
                    <div id="LT" class="block"></div><div id="MT" class="block"></div><div id="RT" class="block"></div>
                    <div id="LM" class="block"></div><div id="MM" class="block"></div><div id="RM" class="block"></div>
                    <div id="LB" class="block"></div><div id="MB" class="block"></div><div id="RB" class="block"></div>
                </div>
            </div>
        </div>
        <button class="admin-btn" onclick="checkAdmin()">ç®¡ç†å“¡ç™»å…¥</button>
    </div>

    <div class="bottom-bar">
        <div class="price-info">
            <div class="price-total" id="display-total">NT$ 0</div>
            <div class="seat-count" id="display-count">å·²é¸ 0 å¼µåº§ä½ (æ—©é³¥åƒ¹ $600/å¼µ)</div>
        </div>
        <button class="btn-checkout" id="btn-open-modal" disabled>ç¢ºèªè³¼ç¥¨</button>
    </div>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal">
            <div class="modal-header">ç¢ºèªè¨‚ä½è³‡è¨Š</div>
            <div class="modal-body">
                <div class="selected-list" id="modal-seat-list">åº§ä½ï¼šæœªé¸æ“‡</div>
                <div class="payment-box">
                    <div style="font-size: 12px; color: #666;">ä»˜æ¬¾æ–¹å¼</div>
                    <div style="font-weight: bold; font-size: 18px; color: var(--primary-blue);">ç¾å ´ç¾é‡‘ç¹³è²»</div>
                    <div style="font-size: 11px; color: #888;">è«‹è‡³ Mia å…‰å¾©é¤¨ç¾å ´ç¹³è²»</div>
                </div>
                <div class="form-group">
                    <label>è³¼ç¥¨äººå§“å</label><input type="text" id="p-name" placeholder="è«‹è¼¸å…¥å§“å">
                </div>
                <div class="form-group">
                    <label>è³¼ç¥¨äººé›»è©±</label><input type="tel" id="p-phone" placeholder="è«‹è¼¸å…¥é›»è©±">
                </div>
                <div class="form-group">
                    <label>ä»˜æ¬¾æ—¥æœŸ</label><input type="date" id="p-date">
                </div>
                <div class="form-group">
                    <label>å”®ç¥¨äººå“¡</label>
                    <select id="p-staff">
                        <option value="">è«‹é¸æ“‡</option><option value="èŠ·ç‘œ">èŠ·ç‘œ</option><option value="Daifi">Daifi</option><option value="Ruby">Ruby</option><option value="å­Ÿè±">å­Ÿè±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>å‚™è¨»</label><input type="text" id="p-note" placeholder="é¸å¡«">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-checkout" style="flex:1; background:#666;" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn-checkout" style="flex:2;" id="btn-confirm-final">ç¢ºèªè³¼ç¥¨</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA8gIluzZA5k8fkIpC0RKvUypsSRZM9rlM",
            authDomain: "seatsystem-dbfc5.firebaseapp.com",
            databaseURL: "https://seatsystem-dbfc5-default-rtdb.firebaseio.com",
            projectId: "seatsystem-dbfc5",
            storageBucket: "seatsystem-dbfc5.firebasestorage.app",
            messagingSenderId: "924114074974",
            appId: "1:924114074974:web:3ad35d39cc6813c636a3cf"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let isAdmin = new URLSearchParams(window.location.search).get('admin') === 'true';
        let seatsData = {};
        let selectedIds = [];
        const PRICE = 600;

        const cameraSeats = ["F15", "F16", "F17", "G15", "G16", "G17"];
        const prSeats = [];
        for(let i=8; i<=20; i++) prSeats.push("A"+i);
        for(let i=9; i<=21; i++) prSeats.push("B"+i);

        const layout = [
            { id: 'T', rows: 5, L: [7,8,9,10,11], M: 13, R: [7,8,9,10,11], start: 'A' },
            { id: 'M', rows: 10, L: 9, M: 13, R: 9, start: 'F' },
            { id: 'B', rows: 10, L: 6, M: 13, R: 6, start: 'P' }
        ];

        onValue(ref(db, 'seats'), (snapshot) => {
            seatsData = snapshot.val() || {};
            render();
        });

        function render() {
            layout.forEach(sec => {
                for(let r=0; r<sec.rows; r++){
                    const rowName = String.fromCharCode(sec.start.charCodeAt(0)+r);
                    const cL = Array.isArray(sec.L)?sec.L[r]:sec.L;
                    const cM = sec.M;
                    const cR = Array.isArray(sec.R)?sec.R[r]:sec.R;
                    updateBlock(`L${sec.id}`, rowName, 1, cL);
                    updateBlock(`M${sec.id}`, rowName, cL+1, cL+cM);
                    updateBlock(`R${sec.id}`, rowName, cL+cM+1, cL+cM+cR);
                }
            });
            updateBottomBar();
        }

        function updateBlock(bid, rowName, start, end) {
            const block = document.getElementById(bid);
            if(rowName==='A' || rowName==='F' || rowName==='P') block.innerHTML = '';
            const rowDiv = document.createElement('div');
            rowDiv.className = 'row';
            for(let s=start; s<=end; s++){
                const id = rowName + s;
                const div = document.createElement('div');
                if (cameraSeats.includes(id)) {
                    div.className = "seat camera-seat";
                } else {
                    const status = (seatsData[id] && seatsData[id].status) ? seatsData[id].status : 'available';
                    const isPR = prSeats.includes(id);
                    div.className = `seat ${status} ${isPR ? 'pr-seat' : ''}`;
                    if(selectedIds.includes(id)) div.classList.add('selected');
                    div.innerText = id;
                    div.onclick = () => handleSeatClick(id);
                }
                rowDiv.appendChild(div);
            }
            block.appendChild(rowDiv);
        }

        function handleSeatClick(id) {
            const current = seatsData[id] || { status: 'available' };
            if(current.status === 'sold') {
                if(isAdmin) {
                    if(confirm(`åº§ä½ ${id}\nè³¼ç¥¨äººï¼š${current.name}\nå”®ç¥¨å“¡ï¼š${current.staff}\nç¢ºå®šè¦é€€ç¥¨å—ï¼Ÿ`)) {
                        update(ref(db, `seats/${id}`), { status: 'available', name: null, phone: null, date: null, staff: null, note: null });
                    }
                } else {
                    alert("æ­¤ä½å·²å”®å‡º");
                }
                return;
            }
            if (selectedIds.includes(id)) {
                selectedIds = selectedIds.filter(i => i !== id);
            } else {
                if(selectedIds.length >= 10) return alert("ä¸€æ¬¡æœ€å¤šé¸è³¼ 10 å¼µ");
                selectedIds.push(id);
            }
            render();
        }

        function updateBottomBar() {
            const count = selectedIds.length;
            document.getElementById('display-total').innerText = `NT$ ${count * PRICE}`;
            document.getElementById('display-count').innerText = `å·²é¸ ${count} å¼µåº§ä½ (æ—©é³¥åƒ¹ $600/å¼µ)`;
            document.getElementById('btn-open-modal').disabled = count === 0;
        }

        // å½ˆçª—æ§åˆ¶
        window.closeModal = () => { document.getElementById('modal-overlay').style.display = 'none'; };
        document.getElementById('btn-open-modal').onclick = () => {
            document.getElementById('modal-overlay').style.display = 'flex';
            document.getElementById('modal-seat-list').innerText = `é¸å–åº§ä½ï¼š${selectedIds.join(', ')}`;
            document.getElementById('p-date').valueAsDate = new Date();
        };

        document.getElementById('btn-confirm-final').onclick = () => {
            const name = document.getElementById('p-name').value;
            const phone = document.getElementById('p-phone').value;
            const staff = document.getElementById('p-staff').value;
            if(!name || !phone || !staff) return alert("è«‹å¡«å¯«å®Œæ•´å§“åã€é›»è©±èˆ‡å”®ç¥¨å“¡");

            const updates = {};
            selectedIds.forEach(id => {
                updates[`seats/${id}`] = {
                    status: 'sold',
                    name, phone, staff,
                    date: document.getElementById('p-date').value,
                    note: document.getElementById('p-note').value
                };
            });
            update(ref(db), updates).then(() => {
                alert("è³¼ç¥¨æˆåŠŸï¼");
                selectedIds = [];
                closeModal();
                render();
            });
        };

        window.checkAdmin = () => {
            const pw = prompt("è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ï¼š");
            if(pw === "mia2026") { isAdmin = true; alert("ç®¡ç†å“¡æ¨¡å¼å·²å•Ÿå‹•ï¼Œé»é¸å·²å”®åº§ä½å¯é€²è¡Œé€€ç¥¨ã€‚"); }
        };
    </script>
</body>
</html>
